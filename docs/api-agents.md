# Fixie Agent API

The Fixie platform allows you to build Agents in any language of your choice, by writing
a service that conforms to the protocol described in [Agent Protocol](agent-protocol.md).
For Python developers, we provide a Python library that makes it easy to implement Agents
using the API described below.

## CodeShotAgent

The base class for Agents in Fixie is [`CodeShotAgent`][fixieai.agents.code_shot.CodeShotAgent].
This class takes care of communicating with the Fixie platform via the [Agent Protocol](agent-protocol.md),
and provides a simple API for registering functions that can be invoked by the few-shot examples
used by the Agent.

The structure of a `CodeShotAgent` is typically as follows:

```python
import fixieai

BASE_PROMPT = "Base prompt for the agent."
FEW_SHOTS = """
Q: Example query for the Agent
Ask Func[my_func]: query to the func
Func[my_func] says: response to the query
A: Response generated by the Agent

Q: Second example query to the agent
A: Second response generated by the Agent
"""

agent = fixieai.CodeShotAgent(BASE_PROMPT, FEW_SHOTS)

@agent.register_func()
def my_func(query: fixieai.Message) -> str:
    return "Response to the query"
```

The `BASE_PROMPT` and `FEW_SHOTS` strings are used to provide examples to the underlying
Large Language Model, such as GPT-3, as well as to provide the Fixie Platform information
on what kinds of queries this Agent can support.

The `FEW_SHOTS` provided to an Agent must be a string consisting of one or more *stanzas*, where
each stanza consists of a question, one or more rounds of internal actions taken by the Agent,
and a final answer. Stanzas must be separated from each other by a blank line. The query line
in the stanza must start with `Q:`, and the answer line must start with `A:`.

Internal actions taken by the Agent can be of one of two forms:
* `Ask Func[<func_name>]: <query_text>`: This indicates that the function `<func_name>` should
  be invoked when the output of the underlying LLM starts with this string. The string following
  `Ask Func[<func_name>]:` is passed to the function as the `query.text` parameter.
* `Ask Agent[<agent_name>]: <query_text>`: This indicates that the Agent `<agent_name>` should
  be invoked when the output of the underlying LLM starts with this string. The string following
  `Ask Agent[<agent_name>]:` is passed to the Agent as the `query.text` parameter.

The `register_func` decorator is used to register a function that can be invoked by the Agent.
The function must take a single parameter, which is a [`Message`][fixieai.agents.api.Message]
object, and must return either a string or a `Message`. The `Message` object contains the text of
the query, as well as any Embeds associated with the Message (see [Embeds](#Embeds) below).

## Embeds

**Embeds** allow arbitrary binary data to be associated with a query or response Message in
Fixie, similar to email attachments. Embeds can be used to store images, video, text, or
any other binary data.

Embeds are represented by the [`Embed`][fixieai.agents.api.Embed] class. Agents can access
the Embeds associated with a Message as follows:

```python
@agent.register_func()
def my_func(query: fixieai.Message) -> str:
    for key, embed in query.embeds.items():
        print(f"Embed key: {key}")
        print(f"Embed content-type: {embed.content_type}")
        embed_value_as_text = embed.text
        embed_value_as_bytes = embed.content
```

An Agent function can also add an Embed to its response Message by adding it to the
`embeds` dictionary of the `Message` object:

```python
@agent.register_func()
def my_func(query: fixieai.Message) -> fixieai.Message:
  reply = fixieai.Message("Response to the query")
  reply.embeds["my_embed"] = fixieai.Embed(content_type="text/plain")
  reply.embeds["my_embed"].text = "Hello, world!"
```


## ::: fixieai.agents.code_shot
    options:
      show_source: true

## ::: fixieai.agents.api
    options:
      show_source: true

## ::: fixieai.agents.utils
    options:
      show_source: true
